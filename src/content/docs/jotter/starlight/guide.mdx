---
title: How to Add View Transitions to a Starlight Site
---

import BoT from "/src/components/BoT.astro"

This guide describes what has to be done to add view transitions to an existing Starlight site using the Starlight support of the <BoT/>.

Don't be afraid that this will turn your beautiful website into a blinking jukebox. The Jotter is just an exaggerated example to show what is possible. If you follow the instructions below, you will be rewarded with a very _subtle_, SPA-like transition effect. And yes, if you want, you can of course later turn the whole thing into a ... blinking jukebox.

:::caution
At the moment, The Bag's support of view transition for Starlight is still a bit experimental. It has not yet been extensively tested in the wild. Enjoy being on the bleeding edge of technology with your Starlight site, but also be prepared that things might break. Or that not everything you expect will work from the start. I'm happy to improve and expand the initial support over time!
:::

## Step 1: Install astro-vtbot

The <BoT/> can be installed as a package or as an Astro integration. See here for [details an differences](/library/Installation/). Let's assume you just add it as a package:

```sh
cd /to/my/starlight/project
npm i -D astro-vtbot
```
Make sure that you have the latest version installed.

## Enable View Transitions

To enable view transitions, we extend Starlight's  **`Head`** component. We create a replacement component and instruct Starlight to use it as a substitute for its Head. Here is [a pointer](https://starlight.astro.build/guides/overriding-components/) to background information on how overriding components works.

The substitute covers all aspects classified as [mandatory actions](/jotter/starlight/#mandatory-actions) on the overview page	.

Components to cover the more optional things are in the works!

### Step 2: Create the New Head Component
Create a new component inside your project. The file name does not matter. For this example, we choose `./src/components/starlight/Head.astro`. You can copy & paste the content for this file:

```astro title="./src/components/starlight/Head.astro"
---
import type { Props } from '@astrojs/starlight/props';
import StarlightHead from '@astrojs/starlight/components/Head.astro';
import VtbotStarlight from 'astro-vtbot/components/starlight/Base.astro';
---

<VtbotStarlight {...Astro.props}>
	<StarlightHead {...Astro.props}><slot /></StarlightHead>
</VtbotStarlight>
```

### Step 3: Use the New Head Component

Now we tell Starlight to replace its `Head` component with ours. Open the `astro.config.mjs`[^1] file from your project directory. Make it look like shown below: Make sure that there is an entry named `components` in the options of your Starlight integration. It must specify a `Head` entry with the path of the file you have just created.

[^1]:Assuming `.mjs` as the extension here but `.ts` would also be fine. of course!

```js title="astro.config.mjs" {8-9}
import { defineConfig } from 'astro/config';
import starlight from "@astrojs/starlight";

export default defineConfig({
	...
	integrations: [starlight({
		...
		components: {
			Head: "./src/components/starlight/Head.astro",
			...
		},
		...
	})]
})
```

<details>

<summary>You already had a different entry for `Head:` in your `astro.config.njs` file?</summary>

> In this case you have to change the `import` of `StarlightHead` in your new `Head` component. Change the import so that it does not load Starlight's standard `Head`, but the  component you had in your components mapping before:

```astro title="./src/components/starlight/Head.astro" del={4} ins={5}
---
// The file you had in you components mapping for Head before now goes here:
// You probably might have to change "./src" to "/src" to ensure the component is found
import StarlightHead from '@astrojs/starlight/components/Head.astro';
import StarlightHead from '/src/components/MySpecialHead.astro';
...
```

</details>

### Try it out for yourself!
Start your project. No matter what browser you use, you should see that there are no full page loads when navigating.

In Chromium browsers, you will see the browser's standard animations for few transitions, i.e. a very quick fade-over of the complete viewport. Browser without native support for view transition will not yet show animations, but just seamlessly swap pages.[^2]

[^2]: Having no fancy, whole viewport animation on a browser without native view transition support is a good thing here. As the exit and entry animations are required to play in sequence, you can not get a real cross-fade. See [here](#animating-the-main-section) on how to animate the main section.

:::tip
If you were just looking for a SPA-like navigation, you are all set!
:::

In the next section, we will extend the view transition effect by adding an animation to the main content area and optimizing the styling.

## Configuring View Transitions

You can configure several aspects of the view transition effect in your new Head component.


### Animating the Main Section

You can add a `transition:animate=...` [directive](https://docs.astro.build/en/guides/view-transitions/#built-in-animation-directives) to the `<VtbotStarlight>` component. The Bag will teleport the directive from there to the `<main>` element of the Starlight page.  This is the way to enable view transition animations for the main content area of a Starlight site for all browsers.

```astro title="How to add animations to the main area"
<VtbotStarlight {...Astro.props} transition:animate="fade">
	<StarlightHead {...Astro.props}><slot /></StarlightHead>
</VtbotStarlight>
```
If you want to add further styling to the transition group, you can explicitly name it by accompanying `transition:animate` with `transition:name="main"`.

### Fallback Control
What [behavior](https://docs.astro.build/en/guides/view-transitions/#fallback-control) do you want for browsers that do not support view transitions natively? Choose from `none`, `swap` or `animate`. Use the `viewTransitionFallback` attribute of the `<VtbotStarlight>` component to tell The Bag what you have chosen:

```astro title="How to specify the fallback option of <ViewTransitions/>"
<VtbotStarlight {...Astro.props} viewTransitionsFallback="animate">
	<StarlightHead {...Astro.props}><slot /></StarlightHead>
</VtbotStarlight>
```
This only serves as an example. It is not necessary to set `viewTransitionsFallback` to `animate` as this is the default setting anyway.

### Sidebar Behavior
By the default, the sidebar content will not change on navigation. Only the current page marker will change. But you can switch this behavior and have the content replaced on each navigation. To do this, add the `replaceSidebarContent` attribute the `VtbotStarlight` tag in your new `Head` component.
```ts title="/src/components/starlight/Head.astro"
<VtbotStarlight {...Astro.props} replaceSidebarContent>
```

### Additional Styling

You can also add a `<style is:global>` section to the file to style the `::view-transition-*` pseudo elements for browsers with native view transition support.


### Example Configuration

Let's revisit our `Head` component and see how it looks with the extensions described above:

```astro title="./src/components/starlight/Head.astro"
---
import type { Props } from '@astrojs/starlight/props';
import StarlightHead from '@astrojs/starlight/components/Head.astro';
import VtbotStarlight from 'astro-vtbot/components/starlight/Base.astro';
import LoadingIndicator from 'astro-vtbot/components/LoadingIndicator.astro';
// import one of Astro's predefined animation functions,
// see https://docs.astro.build/en/guides/view-transitions/#built-in-animation-directives
import { slide } from 'astro:transitions';
---

{/* Define a view transition animation for `<main>`*/}
<VtbotStarlight
	{...Astro.props}
	transition:name="main"
	transition:animate={slide({ duration: 150 })}
>
	<StarlightHead {...Astro.props}><slot /></StarlightHead>
</VtbotStarlight>
{/* update this one to whatever image you want to show as a loading indicator */}
<LoadingIndicator top="80px" right="16px" src="/favicon.svg" />

<style is:global>
	/* Slow down Chrome's default animation */
	::view-transition-group(root) {
		animation-duration: 300ms;
	}

	/* Do not slide over the sidebars */
	::view-transition-group(main) {
		overflow: hidden;
	}
	/* For non-native-view-transition browsers */
	.main-pane {
		overflow: hidden;
	}

	/* let title headings morph into each other */
	main h1 {
		view-transition-name: title-heading;
	}
	::view-transition-group(title-heading) {
		animation-duration: 0.3s;
	}
</style>
```

## Optional Features

This section shows you how you to add the features from the [optional feature list](/jotter/starlight/#optional-part).

### Loading indicator
Independent of the Starlight support, The Bag provides [loading indicators](/library/LoadingIndicator/) for you to choose from. The above [example](#example-configuration) already contains the indicator that makes your favicon flash happily in the top right corner during loading.

## Known Issues

There are some facts that you should be aware of. None of them is a real obstacle on using The Bag's Starlight support.

### View Transitions into Your Starlight Site from the Outside

If you link to a page of your Starlight site from the outside, you should not use view transitions, but do a full page load instead. This way, your Starlight site will be properly initialized  This is also important if you  create a link between two Starlight sites.

The website of The Bag automatically intercepts all links that return to the `/jotter/` and does a full page load. The Bag will soon offer a reusable component to facilitate that.

### Not tested with arbitrary config options
Starlight supports a lot of different config options. The Bags view transition support is so far only tested with a few typical combinations.

Multilingual Starlight sites force a complete reload of the page if you select a different language. This is a good thing, as the app frame changes completely and has to be reloaded anyway.

### Don't use `transition:persist`
We all love `transition:persist`, but just do not use it here. The Starlight integration of <BoT/> is based on the [`<ReplacementSwap/>` component](/library/ReplacementSwap/), which has no use for `transition:persist`. If you want to persist components when using the Bag's Starlight support, just put them somewhere outside the `<main>` area. Done.

## As always, feedback is very welcome!

I look forward to your feedback! Did it work for you? What were the biggest hurdles? What are you looking for?

Get in touch on Discord or discuss on [<BoT/>'s Github pages](https://github.com/martrapp/astro-vtbot) or [its website](https://github.com/martrapp/astro-vtbot-website).
